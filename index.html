<script>
  const contractAddress = "0x98B393Bbde720013287F5d409EE518933AB8a5ad";
  const tokenId = 4;
  const audioUrl = "https://ipfs.io/ipfs/bafybeigdw4xtv7p2ydp3aygbstf2tijmdncsjcyhbxbxigepsrhyr2unwq";
  const abi = [
    "function ownerOf(uint256 tokenId) view returns (address)"
  ];

  document.getElementById('connectBtn').onclick = async () => {
    console.log("ğŸ” Starting connection...");

    if (typeof window.ethereum === 'undefined') {
      alert("MetaMask not detected.");
      return;
    }

    try {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      const signer = provider.getSigner();
      const userAddress = await signer.getAddress();
      document.getElementById("status").innerText = `Connected: ${userAddress}`;
      console.log("âœ… Wallet connected:", userAddress);

      const contract = new ethers.Contract(contractAddress, abi, provider);

      const owner = await contract.ownerOf(tokenId);
      console.log("âœ… Token owner:", owner);

      if (owner.toLowerCase() === userAddress.toLowerCase()) {
        document.getElementById("player").innerHTML =
          `<audio controls src="${audioUrl}" type="audio/mpeg"></audio>`;
      } else {
        document.getElementById("player").innerHTML =
          `<p>ğŸš« You do not own this NFT.</p>`;
      }

    } catch (err) {
      console.error("âŒ Error:", err);
      document.getElementById("status").innerText = "âŒ Could not connect wallet or contract.";
    }
  };
</script>
