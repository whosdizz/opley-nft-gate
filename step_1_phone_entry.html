<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OPLEY Drops</title>
  <style>
    body { background-color: #000; color: white; font-family: sans-serif; margin: 0; padding: 0 1rem 6rem; }
    .drop-card { background-color: #111; border-radius: 20px; padding: 1rem; margin: 1rem 0; text-align: center; }
    .drop-cover { width: 100%; max-width: 300px; height: 300px; border-radius: 20px; background-size: cover; background-position: center; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; position: relative; }
    .drop-cover-overlay { position: absolute; width: 100%; height: 100%; border-radius: 20px; background: rgba(0, 0, 0, 0.5); }
    .drop-preview-button { z-index: 2; border: 2px solid white; border-radius: 50%; padding: 1rem; cursor: pointer; }
    .button { display: block; width: 100%; margin: 0.5rem 0; padding: 0.75rem; background-color: #1e90ff; border: none; border-radius: 10px; color: white; font-size: 1rem; cursor: pointer; }
    .button-outline { background: transparent; border: 1px solid white; }
    .fake-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10; }
    .fake-modal-content { background: #222; padding: 2rem; border-radius: 1rem; text-align: center; }
    .nav { position: fixed; bottom: 0; left: 0; right: 0; background: #000; border-top: 1px solid #444; display: flex; justify-content: space-around; padding: 0.75rem; font-size: 0.9rem; }
    .nav button { background: none; border: none; color: white; cursor: pointer; }
  </style>
</head>
<body>

  <div id="drops-container"></div>

  <div class="nav">
    <button>üî• Drops</button>
    <button onclick="location.href='/player.html'">‚ñ∂ Now Playing</button>
    <button onclick="location.href='/vault.html'">üìÅ Vault</button>
    <button onclick="location.href='/profile.html'">üë§ Profile</button>
  </div>

  <div id="modal" class="fake-modal" style="display:none">
    <div class="fake-modal-content">
      <p>üîí Fake Checkout Modal</p>
      <p>This would launch Stripe or Apple Pay flow.</p>
      <button class="button" onclick="closeModal()">Close</button>
    </div>
  </div>

  <script>
    const metadataCIDs = [
      "bafkreigryn3raal2ri3om2w72ajitkdglkmhfydvuekhubvxzspod2nj74"
    ];
    const ipfsGateway = "https://gateway.pinata.cloud/ipfs/";
    const container = document.getElementById('drops-container');

    metadataCIDs.forEach(async (cid, index) => {
      const res = await fetch(ipfsGateway + cid);
      const meta = await res.json();

      const releaseDate = new Date(meta.releaseDate);
      const now = new Date();
      const diff = releaseDate - now;
      let timeLeft = "‚è≥ Now Available";
      if (diff > 0) {
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
        const minutes = Math.floor((diff / (1000 * 60)) % 60);
        timeLeft = `‚è≥ ${days}d ${hours}h ${minutes}m left`;
      }

      const card = document.createElement('div');
      card.className = 'drop-card';
      card.innerHTML = `
        <h3>${meta.artist}</h3>
        <div class="drop-cover" style="background-image: url('${ipfsGateway + meta.image}')">
          <div class="drop-cover-overlay"></div>
          <div class="drop-preview-button" onclick="playPreview('${ipfsGateway + meta.mobileAudio}')">‚ñ∂</div>
        </div>
        <h4>${meta.title}</h4>
        <p>Release Date: ${new Date(meta.releaseDate).toDateString()}</p>
        <p>${timeLeft}</p>
        <p><em>‚ÄúThis song is not on Spotify or Apple Music.‚Äù</em></p>
        ${
          meta.unlocked
            ? `<div class="button" style="background:#4caf50;">üéâ Unlocked ‚Äì ‚ñ∂ Play Now</div>`
            : `<button class="button" onclick="showModal()">UNLOCK FULL TRACK ‚Äì ${meta.price || '$0.99'}</button>
               <div style="display:flex; gap:10px;">
                 <button class="button button-outline">Ô£øPay</button>
                 <button class="button button-outline">Credit Card</button>
               </div>`
        }
      `;
      container.appendChild(card);
    });

    function playPreview(url) {
      const audio = new Audio(url);
      audio.currentTime = 0;
      audio.play();
    }

    function showModal() {
      document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }
  </script>
</body>
</html>
